rtabmap:
  ros__parameters:
    # Базовые фреймы
    frame_id: "base_link"
    map_frame_id: "map"
    odom_frame_id: "odom"

    # Подписки
    subscribe_depth: true
    subscribe_rgb: true
    subscribe_scan: true
    subscribe_scan_cloud: false
    subscribe_odom_info: true

    # Синхронизация
    approx_sync: true
    approx_sync_max_interval: 0.8
    topic_queue_size: 50
    sync_queue_size: 50

    # Частота обработки
    Rtabmap/DetectionRate: 1.0        # Гц; можно поднять до 2–3, если потянет

    # Порог обновления карты
    RGBD/LinearUpdate: 0.1            # м
    RGBD/AngularUpdate: 0.1           # рад
    RGBD/OptimizeMaxError: 3.0

    # Одометрия
    Mem/UseOdomFeatures: true
    RGBD/ForceOdom3DoF: true          # 2D робот

    # Грид / карта
    Grid/CellSize: 0.05
    Grid/RangeMax: 8.0
    Grid/3D: true                     # 3D-оккупация; если тяжело — можно выключить
    Grid/FromDepth: true              # строить из depth (вместе с лазером)
    Grid/Sensor: 2                    # 0=laser,1=depth,2=laser+depth

    # Память
    Rtabmap/TimeThr: 0                # без жёсткого лимита по времени обновления
    Rtabmap/MemoryThr: 0              # без лимита по числу узлов (следи за RAM)
    Mem/STMSize: 10
    Mem/RecentWmRatio: 0.2
    Mem/NotLinkedNodesKept: true

    # Фичи / визуальная часть
    Kp/MaxFeatures: 500
    Kp/DetectorStrategy: 8            # GFTT/ORB
    Vis/MaxFeatures: 1000
    Vis/MinInliers: 20
    Vis/EstimationType: 1             # PnP

    # Луп-кложер
    Rtabmap/LoopThr: 0.11
    RGBD/AggressiveLoopThr: 0.05

    # Логи / дебаг
    Rtabmap/PublishStats: true
    Rtabmap/PublishRAMUsage: false